#!/bin/sh

echo "Setting permissions..."
chmod -R 777 /home/$(logname) >/dev/null

echo "Hiding unwanted applications..."
add_nodisplay() {
  file="$1"
  sed -i '/^NoDisplay=/d' "$file" 2>/dev/null
  echo 'NoDisplay=true' >> "$file"
}
add_nodisplay /usr/share/applications/gnome-language-selector.desktop
add_nodisplay /usr/share/applications/gnome-session-properties.desktop
sed -i '/^NoDisplay=true/d; /^Type=Application/a NoDisplay=true' /usr/share/applications/org.gnome.TextEditor.desktop 2>/dev/null

echo "Adding i386 architecture and updating..."
dpkg --add-architecture i386 2>/dev/null
apt-get update -y >/dev/null

echo "Installing packages..."
apt -y install steam virt-manager gnome-shell-extension-manager plasma-discover flatpak >/dev/null
apt remove -y firefox >/dev/null

echo "Setting up Flatpak..."
flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo >/dev/null
flatpak install -y flathub org.vinegarhq.Sober >/dev/null

echo "Removing Snap packages..."
snap remove firefox firmware-updater desktop-security-center >/dev/null

echo "Installing Brave browser..."
curl -fsS https://dl.brave.com/install.sh | sh 2>&1 | grep -i "error"

echo "Installing Minecraft..."
curl -o Minecraft.deb https://launcher.mojang.com/download/Minecraft.deb 2>/dev/null
apt -y install ./Minecraft.deb >/dev/null
rm /usr/share/applications/minecraft-launcher.desktop ./Minecraft.deb 2>/dev/null

echo "Creating Minecraft desktop entry..."
cat > ~/.local/share/applications/minecraft-launcher.desktop <<EOF
[Desktop Entry]
Name=Minecraft Launcher
Comment=Launch Minecraft
Exec=env GTK_IM_MODULE=none QT_IM_MODULE=none XMODIFIERS= __GLFW_IM_MODULE=none minecraft-launcher
Icon=minecraft-launcher
Terminal=false
Type=Application
Categories=Game;Application;
StartupWMClass=minecraft-launcher
EOF

echo "Adding user to libvirt group..."
usermod -aG libvirt "$(logname)" 2>/dev/null
