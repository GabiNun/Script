#!/bin/sh

chmod -R u+rwX,go-rwx /home/gabi

add_nodisplay() {
  file="$1"
  sed -i '/^NoDisplay=/d' "$file"
  echo 'NoDisplay=true' >> "$file"
}

add_nodisplay /usr/share/applications/gnome-language-selector.desktop
add_nodisplay /usr/share/applications/gnome-session-properties.desktop

sed -i '/^NoDisplay=true/d; /^Type=Application/a NoDisplay=true' /usr/share/applications/org.gnome.TextEditor.desktop

apt update -y
apt install -y software-properties-common dpkg wget

add-apt-repository multiverse -y
dpkg --add-architecture i386
apt update -y

apt install -y steam virt-manager gnome-shell-extension-manager libgdk-pixbuf2.0-0 plasma-discover flatpak

apt upgrade -y

flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo

apt remove -y firefox || true
snap remove firefox || true

wget -q https://launcher.mojang.com/download/Minecraft.deb -O /tmp/Minecraft.deb
dpkg -i /tmp/Minecraft.deb || apt-get install -f -y
rm -f /tmp/Minecraft.deb
rm -f /usr/share/applications/minecraft-launcher.desktop

usermod -aG libvirt "$(whoami)"

tee /usr/share/applications/brave-browser.desktop > /dev/null <<'EOF'
[Desktop Entry]
Name=Brave Web Browser
GenericName=Web Browser
Comment=Access the Internet
Exec=/usr/bin/brave-browser-stable --ozone-platform=x11 %U
Terminal=false
Icon=brave-browser
Type=Application
Categories=Network;WebBrowser;
MimeType=application/pdf;application/rdf+xml;application/rss+xml;application/xhtml+xml;application/xhtml_xml;application/xml;image/gif;image/jpeg;image/png;image/webp;text/html;text/xml;x-scheme-handler/http;x-scheme-handler/https;
Actions=new-window;new-private-window;

[Desktop Action new-window]
Name=New Window
Exec=/usr/bin/brave-browser-stable --ozone-platform=x11

[Desktop Action new-private-window]
Name=New Incognito Window
Exec=/usr/bin/brave-browser-stable --ozone-platform=x11 --incognito
EOF

mkdir -p ~/.local/share/applications
cat > ~/.local/share/applications/minecraft-launcher.desktop <<EOF
[Desktop Entry]
Name=Minecraft Launcher
Comment=Launch Minecraft
Exec=env GTK_IM_MODULE=none QT_IM_MODULE=none XMODIFIERS= __GLFW_IM_MODULE=none minecraft-launcher
Icon=minecraft-launcher
Terminal=false
Type=Application
Categories=Game;Application;
StartupWMClass=minecraft-launcher
EOF
